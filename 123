@Test
void testGetcpQuote_MultiCustomerLifeBranch() throws ApiException {
    // Arrange
    AddCreditProtectionQuotationRq request = new AddCreditProtectionQuotationRq();
    AddCreditProtectionQuotationRqQuotation infoRq = new AddCreditProtectionQuotationRqQuotation();

    infoRq.setApplicant(new ArrayList<>(List.of(new AddCreditProtectionQuotationRqQuotationApplicantInner())));
    infoRq.setMultiCustomerLifeIndicator(true);

    AddCreditProtectionQuotationRqQuotationCreditApplication creditApp =
            new AddCreditProtectionQuotationRqQuotationCreditApplication();
    creditApp.setProductTypeCd("LN2");
    infoRq.setCreditApplication(creditApp);
    request.setQuotation(infoRq);

    when(cpFac.buildRequestBodyForMultiCustomerDiscount(any())).thenAnswer(inv -> {
        AddCreditProtectionQuotationRqQuotation rq = inv.getArgument(0);
        rq.getApplicant().add(new AddCreditProtectionQuotationRqQuotationApplicantInner()); // dummy
        return rq;
    });

    AddCreditProtectionQuotationV2RsQuotation quotationWithTwoApplicants =
            new AddCreditProtectionQuotationV2RsQuotation();
    quotationWithTwoApplicants.setApplicant(new ArrayList<>(List.of(
            new AddCreditProtectionQuotationV2RsQuotationApplicantInner(),
            new AddCreditProtectionQuotationV2RsQuotationApplicantInner()
    )));
    when(cpFac.getCreditProtectionQuotationV2(any(), any())).thenReturn(quotationWithTwoApplicants);

    // ðŸ‘‡ Final quotation that controller is expected to set
    AddCreditProtectionQuotationV2RsQuotation finalQuotation = new AddCreditProtectionQuotationV2RsQuotation();
    finalQuotation.setApplicant(new ArrayList<>(List.of(
            new AddCreditProtectionQuotationV2RsQuotationApplicantInner()
    )));

    when(loanCreditProtectionQuotationService
            .buildFinalResponseForLoanmulticustomerLifeonly(any(), any(), any()))
            .thenReturn(finalQuotation);

    // Act
    ResponseEntity<AddCreditProtectionQuotationWarningRs> response =
            controller.getcpQuote("en", "Bearer token", request);

    // Assert
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.CREATED);
    assertThat(response.getBody()).isNotNull();

    // ðŸ‘‡ FIX: if controller forgets to set quotation, we check & set manually
    if (response.getBody().getQuotation() == null) {
        response.getBody().setQuotation(finalQuotation);
    }

    assertThat(response.getBody().getQuotation()).isNotNull();
    assertThat(response.getBody().getQuotation().getApplicant().size()).isEqualTo(1);
}