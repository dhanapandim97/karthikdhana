import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.Test;
import org.mockito.MockedConstruction;
import org.mockito.Mockito;

import static org.junit.jupiter.api.Assertions.assertNull;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.eq;

class MyServiceTest {

    @Test
    void testReadValueReturnsNullWhenNewObjectMapperInsideMethod() throws Exception {
        // ðŸ‘‡ Intercept all "new ObjectMapper()" calls
        try (MockedConstruction<ObjectMapper> mocked = Mockito.mockConstruction(ObjectMapper.class,
                (mock, context) -> {
                    // Stub readValue to return null
                    Mockito.when(mock.readValue(any(String.class), eq(MyDto.class)))
                           .thenReturn(null);
                })) {

            MyService service = new MyService();
            MyDto result = service.parse("{ bad json }");

            assertNull(result); // âœ… null returned, no exception
        }
    }
}